<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Painel Administrativo - Gatonautas</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f0f4f8;
      color: #222;
      margin: 0;
      padding: 20px;
      max-width: 900px;
      margin-left: auto;
      margin-right: auto;
    }
    h1, h2, h3 {
      color: #ff6f61;
    }
    button {
      background-color: #ff6f61;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 25px;
      cursor: pointer;
      font-weight: 700;
      margin-top: 8px;
      transition: background-color 0.3s ease;
    }
    button:hover {
      background-color: #e65a50;
    }
    .logout-btn {
      float: right;
      margin-bottom: 20px;
      background-color: #555;
    }
    .logout-btn:hover {
      background-color: #333;
    }
    section {
      margin-bottom: 40px;
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    .product-item, .contact-item {
      border-bottom: 1px solid #ddd;
      padding: 12px 0;
    }
    .product-item:last-child, .contact-item:last-child {
      border-bottom: none;
    }
    .product-actions {
      margin-top: 8px;
    }
    input, textarea {
      width: calc(100% - 24px); /* Ajuste para padding */
      padding: 8px 12px;
      margin: 8px 0;
      border-radius: 8px;
      border: 1px solid #ccc;
      font-size: 1rem;
      resize: vertical;
      box-sizing: border-box; /* Para incluir padding e borda na largura total */
    }
    label {
      font-weight: 600;
      color: #ff6f61;
      display: block; /* Para garantir que o input fique abaixo */
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <button class="logout-btn" id="logoutBtn">Sair</button>
  <h1>Painel Administrativo</h1>

  <section>
    <h2>Produtos Cadastrados</h2>
    <div id="produtosLista">
      </div>

    <h3>Adicionar Novo Produto</h3>
    <form id="formAddProduto">
      <label for="name">Nome</label>
      <input type="text" id="name" required />
      
      <label for="description">Descrição</label>
      <textarea id="description" rows="2" required></textarea>
      
      <label for="price">Preço (ex: 29.90)</label>
      <input type="number" id="price" step="0.01" required />
      
      <label for="image">URL da Imagem</label>
      <input type="text" id="image" required />

      <button type="submit">Adicionar Produto</button>
    </form>
  </section>

  <section>
    <h2>Mensagens Recebidas</h2>
    <div id="contatosLista">
      </div>
  </section>

<script>
  const apiBase = 'https://gatonautas-backend.onrender.com'; // Use sua URL do Render
  const token = localStorage.getItem('token'); // Token de ADMIN

  if (!token && window.location.pathname.endsWith('admin.html')) {
    alert('Acesso restrito. Por favor, faça o login como administrador.');
    window.location.href = 'login.html'; // Ou a página de login específica do admin
  }

  const logoutBtn = document.getElementById('logoutBtn');
  if (logoutBtn) {
    logoutBtn.addEventListener('click', () => {
      localStorage.removeItem('token');
      alert('Logout realizado com sucesso.');
      window.location.href = 'login.html'; // Ou a página de login específica do admin
    });
  }

  // ... (suas funções carregarProdutos, removerProduto, adicionarProduto) ...
  // Elas continuarão funcionando com o db.json como antes.

  // Carregar mensagens de contato (do db.json via backend)
  async function carregarContatos() {
    if (!token) {
        const contatosListaContainer = document.getElementById('contatosLista');
        if(contatosListaContainer) contatosListaContainer.innerHTML = '<p>Faça login como administrador para ver as mensagens.</p>';
        return;
    }
    try {
      const res = await fetch(`${apiBase}/contatos`, {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (!res.ok) {
         const errorData = await res.json().catch(() => ({ message: 'Erro desconhecido ao carregar mensagens.' }));
         throw new Error(errorData.message || `Erro HTTP: ${res.status}`);
      }

      const contatos = await res.json(); // Espera um array [{id, nome, email, mensagem, data, lido?}, ...]
      const container = document.getElementById('contatosLista');
      container.innerHTML = '';

      if (!contatos || contatos.length === 0) {
        container.innerHTML = '<p>Nenhuma mensagem recebida ainda.</p>';
        return;
      }

      // As mensagens já devem vir ordenadas do backend se você usou .sort() lá.
      contatos.forEach(c => {
        const div = document.createElement('div');
        div.className = 'contact-item';
        div.innerHTML = `
          <strong>De: ${c.nome || 'Anônimo'}</strong> (${c.email || 'Sem email'})<br/>
          <p style="white-space: pre-wrap; margin-top: 5px; margin-bottom: 5px;">${c.mensagem || 'Sem mensagem.'}</p>
          <em>Enviado em: ${c.data ? new Date(c.data).toLocaleString('pt-BR') : 'Data desconhecida'}</em><br/>
          <em>Status: ${c.lido ? 'Lida' : 'Não lida'}</em>
        `;
        container.appendChild(div);
      });
    } catch (error) {
      console.error('Erro ao carregar mensagens de contato:', error);
      // alert(`Erro ao carregar mensagens: ${error.message}. Faça login novamente se o problema persistir.`);
      const container = document.getElementById('contatosLista');
      if (container) {
        container.innerHTML = `<p style="color:red;">Erro ao carregar mensagens. Tente recarregar a página.</p>`;
      }
      if (error.message.includes("Token inválido") || error.message.includes("Token não fornecido")) {
          localStorage.removeItem('token');
          window.location.href = 'login.html';
      }
    }
  }

  window.onload = () => {
    if (token && window.location.pathname.endsWith('admin.html')) {
        // Assumindo que você tem uma função global chamada carregarProdutos
        if (typeof window.carregarProdutos === 'function') {
            window.carregarProdutos();
        }
        carregarContatos();
        
        const formAddProduto = document.getElementById('formAddProduto');
        if (formAddProduto) {
            formAddProduto.style.display = '';
        }
    } else if (window.location.pathname.endsWith('admin.html')) {
        const produtosListaContainer = document.getElementById('produtosLista');
        if(produtosListaContainer) produtosListaContainer.innerHTML = '<p>Faça login como administrador para gerenciar produtos.</p>';
        
        const contatosListaContainer = document.getElementById('contatosLista');
        if(contatosListaContainer) contatosListaContainer.innerHTML = '<p>Faça login como administrador para ver as mensagens.</p>';
        
        const formAddProduto = document.getElementById('formAddProduto');
        if (formAddProduto) {
            formAddProduto.style.display = 'none';
        }
    }
  };
</script>
</body>
</html>